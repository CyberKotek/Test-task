# Test-task

## Установка
```bash
git clone https://github.com/CyberKotek/Test-task/
cd Test-task
pip install -r requirements.txt
```
## Запуск
```bash
python3 api/main.py <ip> <port>
```
Заместо \<ip\> и \<port\> поставьте ip-адрес и порт, на котором хотите запустить.

## Структура
Прокет основан на FastAPI, на Unicorn. В папке api/router лежат модули для эндпоинтов. В папке api лежит главный файл main.py, и несколько файлов для корректной работы проекта.

## Структура БД
В БД есть 5 таблицы: librarians, readers, books, borrows, returned_borrows.<br /><br />
Данные библиотекарей храняться в таблице librarians <br />(id: id, имя: name, почта: email, захешированный пароль: paswword)<br /><br />
Данные читателей хранятся в таблице reader <br />(id: id, имя: name, почта: email, существует: exists)<br /><br />
Данные книг хранятся в таблице book <br />(id: id, название: name, автор: author, год публикации: published_year, isbn: isbn, количество: amount, существует: exists)<br /><br />
Данные каждой активной операции взятия книги (когда читатель еще не вернул книгу) хранятся в таблице borrows <br />(id: id, id книги: book_id, id читателя: reader_id, дата взятия книги: borrow_date)<br /><br />
Данные завершенных операций взятия книги (когда читатель вернул книгу) хранятся в таблице returned_borrows <br />(id: id, id книги: book_id, id читателя: reader_id, дата взятия книги: borrow_date, дата возрата книги: return_date)<br /><br />

## Бизнес логика
Каждая книга и каждый читатель связан с активными операциями (взятием книг). Это позволяет легко и быстро считать количество взятых книг читателем, и сколько раз конкретная книга была взята.<br />
При взятии книги создается запись в таблице borrows и связывается с книгой которую взяли, и с читателем, который взял. При возрате книги, запись переходит в таблицу returned_borrows, и запись из borrow пропадает.При следующем запросе можно легко отследить, какое количество книг взято, и сколкьо книг взял читатель.<br />
Из-за релейшена между таблицами, удалять какие-либо объекты не очень хорошая идея, поэтому я сделал для объектов поле exists (bool) для отслеживания, является ли этот объект удаленным или нет.

## Токены и безопасность
Пароли всех библиотекарей хранятся в виде хеша. Для этого я использовал библиотеку bcrypt.<br />
Когда библиотекарь обращается к API на эндпоинт "/login", ему генерируется JWT токен. Токен состоит из хедера: (alg: алгоритм хеширования, typ: тип токена), пейлоада: (sub: почта, exp: время когда токен перестанет работать) и подписи (делается с помощью алгоритма указанного в alg в хедере).<br />
Для реализации JWT токенов, я использоапл библиотеку jwt.<br />
Все эндпоинты кроме "/login" и "/register" защищены, так как содержат конфиденциальную информацию. Да и незачем кому-попало лезть в эту систему.

## Дополнительная фича
Можно сделать личный кабинет для каждого читателя, чтобы он мог смотреть какие книги у него на руках и вовремя возращать их. Сделать это можно создав поле пароль в таблицы читателей, изменить эндпоинты "/login" и "/register", чтобы читатели тоже могли ими пользоваться. Так же нужно запретить доступ читателям к эндпоинтам для библиотекарей, и разрешить для тех которые будут созданы для них.
